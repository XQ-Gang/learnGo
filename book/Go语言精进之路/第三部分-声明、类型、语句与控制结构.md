# 声明、类型、语句与控制结构

## 8 使用一致的变量声明形式

Go 语言有两类变量：

- 包级变量：在 package 级别可见的变量，如果是导出变量，则该包级变量也可以被视为全局变量。
- 局部变量：函数或方法体内声明的变量，仅在函数或方法体内可见。

包级变量的声明形式：

- **声明并同时显式初始化**：`var variableName = InitExpression`。Go 编译器会自动根据右侧的 InitExpression 表达式求值的类型确定左侧所声明变量的类型，整型初始化默认为 int，浮点值初始化默认为 float64，如果不接受默认类型，而是要显示指定类型，推荐使用`var a = float32(3.14)`，不推荐使用`var a float32 = 3.14`。
- **声明但延迟初始化**：`var variableName variableType`。虽然没有显式初始化，但 Go 语言会让这些变量拥有初始的“**零值**”。如果是自定义的类型，保证其零值可用是非常必要的。
- **声明聚类**：将同一类的变量声明放在一个 var 块中，将不同类的声明放在不同的 var 块中；或者将延迟初始化的变量放在一个 var 块，而将声明并显式初始化的变量放在另一个 var 块中。
- **就近原则**：尽可能在靠近第一次使用变量的位置声明该变量。就近原则实际上是变量的**作用域最小化**的一种实现手段。

局部变量的声明形式：

- 对于**延迟初始化**的局部变量声明，采用带有 var 关键字的声明形式：`var b []byte`。
- 对于**声明且显式初始化**的局部变量，建议使用**短变量**声明形式：`a := 3.14`，对于不接受默认类型的变量：`a := float32(3.14)`。
- 尽量在**分支控制**时应用**短变量**声明形式：`for _, b := range *v`。体现出“**就近原则**”，让变量的作用域最小化。
- 对于良好的函数/方法设计讲究的是“**单一职责**”，因此每个函数/方法的规模都不大，很少需要应用 var 块来聚类声明局部变量。当然，如果遇到适合聚类的应用场景，也应该毫不犹豫地使用 var 块来声明多个局部变量。

## 9 使用无类型常量简化代码

Go 语言中的 const 整合了 C 语言中宏定义常量、const 只读变量和枚举变量三种形式，并消除了每种形式的不足，使得 Go 常量成为**类型安全**且**对编译器优化友好**的语法元素。Go 常量在声明时并不显式指定类型，也就是说使用的是**无类型常量**。

所有常量表达式的求值计算都可以在**编译期**而不是在**运行期**完成，这样既可以减少运行时的工作，也能方便编译器进行编译优化。当操作数是常量时，在编译时也能发现一些运行时的错误，例如整数除零、字符串索引越界等。

无类型常量是 Go 语言推荐的实践，它拥有和字面值一样的灵活特性，可以直接用于更多的表达式而不需要进行显示类型转换，从而简化了代码编写。此外，按照 [Go 官方语言规范](https://tip.golang.org/ref/spec#Constants) 的描述，数值型无类型常量可以提供比基础类型更高精度的算术运算，至少有 256bit 的运算精度。

## 参考

《Go 语言精进之路：从新手到高手的编程思想、方法和技巧》——白明