# 测试、性能剖析与调试

## 40 理解包内测试与包外测试的区别

**包内测试**：将测试代码放在与被测包同名的包中的测试方法。本质上是一种**面向实现的白盒测试**。

- 优势：测试代码可以访问该包下的所有符号；可以更为直接地构造测试数据和实施测试逻辑；更容易达到较高的测试覆盖率。
- 问题：测试代码自身需要经常性的维护；容易引起包循环引用。

**包外测试**：将测试代码放在名为被测包包名+"_test"的包中的测试方法。本质是一种**面向接口的黑盒测试**。

- 优势：包外测试代码与被测试包充分解耦，很少随着被测代码内部实现逻辑的调整而进行调整和维护。
- 问题：存在测试盲区，容易出现对被测试包的测试覆盖不足的情况。
- 惯用法：**安插后门**，在被测包下的 **export_test.go** 既不会被包含在正式产品代码中，又不包含任何测试代码，而仅被用于被测包的内部符号在测试阶段暴露给包外测试代码，或者定义一些辅助包外测试的代码，比如扩展被测包的方法集合。

**优先使用包外测试**：

- 包外测试更适合编写偏向**集成测试**的用例，它可以任意导入外部包，并测试与外部多个组件的交互。
- 当运用包外测试与包内测试共存的方式时，可考虑让包外测试和包内测试聚焦于不同的测试类型。

## 参考

《Go 语言精进之路：从新手到高手的编程思想、方法和技巧》——白明