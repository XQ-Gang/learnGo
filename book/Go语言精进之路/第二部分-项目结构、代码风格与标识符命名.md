# 项目结构、代码风格与标识符命名

## 5 使用得到公认且广泛使用的项目结构

Go 语言典型项目结构：

1. [最小标准布局](https://github.com/golang-standards/project-layout/issues/117#issuecomment-828503689)
2. 以构建二进制可执行文件为目的的 Go 项目结构
   - cmd 或 app 目录：存放项目要构建的可执行文件对应的 main 包的源文件。main 包用于做命令行参数解析、资源初始化、日志设施初始化、数据库连接初始化等工作，之后就会将程序的执行权限交给更高级的执行控制对象。
   - pkg 或 lib 目录：存放项目自身要使用并且同样也是可执行文件对应 main 包要依赖的库文件。该目录下的包可以被外部项目引用，算是项目导出包的一个聚合。
   - Makefile：项目构建工具所用脚本的“代表”，它可以代表任何第三方构建工具所用的脚本。对于构建脚本较多的项目，也可以建立 build 目录，并将构建脚本的规则属性文件、子构建脚本放入其中。
   - go.mod 和 go.sum：Go 语言包依赖管理使用的配置文件。
   - vendor 目录（可选）：用于在项目本地缓存特定版本依赖包的机制。
3. 以只构建库为目的的 Go 项目结构
   - 去除了 cmd 和 pkg 两个子目录：由于仅构建库，没必要保留存放二进制文件 main 包源文件的 cmd 目录；由于 Go 库项目的初衷一般都是对外部（开源或组织内部公开）暴露 API，因此也没必要将其单独聚合到 pkg 目录下面。
   - vendor 不再是可选目录：推荐仅通过 go.mod 明确表述项目依赖的模块或包以及版本要求。
4. 关于 internal 目录：无论是哪种类型的 Go 项目，对于不想暴露给外部引用，仅限项目内部使用的包，在项目结构上可以通过 internal 包机制来实现。

上述参考项目结构与产品设计开发领域的最小可行产品（Minimum Viable Product，MVP）的思路异曲同工，开发者可以在这样一个最小的项目结构核心的基础上根据实际需要进行扩展。

## 6 提交前使用 gofmt 格式化源码

gofmt 最大的特点是**没有提供任何关于代码风格设置的命令行选项和参数**。

使用 gofmt：

- gofmt -s：简化代码，没有副作用，默认选项。
- gofmt -r 'pattern -> replacement'：代码“微重构”，表达式级别的替换。
- gofmt -l：按格式要求输出满足条件的文件列表。

使用 goimports：在 gofmt 的基础上增加了对包导入列表的维护功能，可根据源码的最新变动自动从导入包列表中增删包。

## 参考

《Go 语言精进之路：从新手到高手的编程思想、方法和技巧》——白明