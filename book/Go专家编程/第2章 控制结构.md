# 控制结构

## 2.1 select

- 管道关闭后仍可读取数据
- 空的 select 语句会永久阻塞
- 使用场景
  - 永久阻塞：启动协程处理任务，并且不希望 main 函数退出
  - 快速检错：使用管道传输错误，快速检查管道中是否有错误，避免陷入循环
  - 限时等待：创建只有一定时效的定时器管道，管理函数上下文
- Runtime 包中提供了 selectgo() 方法处理 select 语句
  - 通过随机函数 fastrandn() 将原始的 case 顺序打乱，在遍历各个 case 时使用打乱后的顺序就会表现出**随机**性。
  - 循环遍历各个 case 时，如果发现某个 case 就绪（管道可读或可写），则直接跳出循环进行管道操作并返回。
  - 循环变量遍历各个 case 时，循环能正常结束（没有跳转），说明所有 case 都没有就绪，如果有 default 语句则命中 default。
  - 如果所有 case 都未命中且没有 default，selectgo() 将阻塞等待所有管道，任一管道就绪后，都将开始新的循环。

## 参考

《Go 专家编程》——任洪彩
